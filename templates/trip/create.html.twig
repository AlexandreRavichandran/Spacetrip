{% extends 'base.html.twig' %}
{% set distance = 0 %}
{% block title %}Reservation d'un voyage{% endblock %}

{% block body %}
{% include 'trip/partials/_form.html.twig' %}
{% endblock %}
{% block javascripts %}
<script>
    $(document).ready(function(){

        $('.descriptionForm').html('Réservé par {{app.user.userName}}');

          // preset destination informations
    destination = $('#destination').val()

    $.ajax({
        method: "GET",
        url: '/destinations/getAjaxData/' + destination
    })

        .done(function (data, status) {
            $('#distance').html(Math.round(data['distance']));
            $('#gravity').html(data['gravity']);
            $('#description').html(data['description']);
            $('#totalPrice').html(Math.round(2500 + parseFloat($('#reservationPrice').html()) + parseFloat($('#pricePerDistance').html()) * data['distance']))
        })

    //Preset spacecraft informations
    spacecraft = $('#spacecraft').val()

    $.ajax({
        method: "GET",
        url: '/spacecrafts/getAjaxData/' + spacecraft
    })

        .done(function (data, status) {
            
            $('#brand_origin').html(data['brand'] + ' - ' + data['nationality'])
            $('#reservationPrice').html(data['reservationPrice'])
            $('#pricePerDistance').html(data['pricePerDistance'])
            $('#rating').html(data['rating'])
            $('#possible_destination').html(data['possibleDestination'])
            $('#available_seat_number').html(data['numberOfSeat'])
            $('#speed').html(data['speed'] + ' km/h')
            $('#totalPrice').html(Math.round(2500 + data['reservationPrice'] + data['pricePerDistance'] * $('#distance').html()))
        })
    $('#trip_departureAt').change(function(){
        console.log(nationality)
        let date = $('#trip_departureAt_date_day').val() + '-' + $('#trip_departureAt_date_month').val() + '-' + $('#trip_departureAt_date_year').val() 
        console.log(date);
        $.ajax({
            method:"GET",
            url:'/trips/create/weather/'+ nationality + '/'+ date
        })
        .done(function(data,status){
            $('#departureDateWeather').removeClass('d-none');
            $('#departureDateWeatherIcon').attr('src','http://openweathermap.org/img/wn/' + data['weather']['icon']+ '@2x.png')
            $('#weather').html(data['weather']['description']);
        })
    })

    })
</script>
{% endblock %}
